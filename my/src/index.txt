// src/router/index.tsx

import { createRouter, createRootRoute, Route } from '@tanstack/react-router';
import MainLayout from '../components/layout/MainLayout';

// ğŸ’¡ ãƒšãƒ¼ã‚¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ (å®Ÿéš›ã®ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£)
import PackListPage from '../pages/PackListPage';      // ãƒ‘ãƒƒã‚¯ä¸€è¦§ç”»é¢
import PackEditPage from '../pages/PackEditPage';      // ãƒ‘ãƒƒã‚¯ç·¨é›†/ä½œæˆç”»é¢
import CardPoolPage from '../pages/CardPoolPage';      // ã‚«ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ«ç”»é¢
import PackOpenerPage from '../pages/PackOpenerPage';  // ãƒ‘ãƒƒã‚¯é–‹å°ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ç”»é¢
import DeckListPage from '../pages/DeckListPage';       // ãƒ‡ãƒƒã‚­ä¸€è¦§ãƒšãƒ¼ã‚¸
import DeckEditPage from '../pages/DeckEditPage';       // ãƒ‡ãƒƒã‚­ç·¨é›†ç”»é¢

// ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ã€‚ï¼ˆä»–ã®ãƒ«ãƒ¼ãƒˆã¯çœç•¥ï¼‰
// âŒ ä»¥å‰ã‚ã£ãŸãƒ­ãƒ¼ã‚«ãƒ«å®šç¾©ã¯ã€å®Ÿéš›ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨è¡çªã™ã‚‹ãŸã‚å‰Šé™¤æ¸ˆã¿
const HomePage = () => <div>ãƒ›ãƒ¼ãƒ ç”»é¢</div>;
const SettingsPage = () => <div>è¨­å®šãƒšãƒ¼ã‚¸</div>;

// 1. ãƒ«ãƒ¼ãƒˆå®šç¾©ã®åŸºç›¤ (Root)
const rootRoute = createRootRoute({
	component: MainLayout, 
});

// 2. Index (ãƒ›ãƒ¼ãƒ )
const indexRoute = new Route({
	getParentRoute: () => rootRoute,
	path: '/',
	component: HomePage,
});

// 3. ãƒ‡ãƒ¼ã‚¿ç®¡ç†é ˜åŸŸ (/data)
const dataRoute = new Route({
	getParentRoute: () => rootRoute,
	path: 'data',
});

// 3.1. ãƒ‘ãƒƒã‚¯ä¸€è¦§ãƒ«ãƒ¼ãƒˆ (Home)
const packListRoute = new Route({
	getParentRoute: () => dataRoute,
	path: 'packs', // /data/packs
	component: PackListPage, // <= ãƒ‘ãƒƒã‚¯ä¸€è¦§ç”»é¢ã‚’è¡¨ç¤º
});

// 3.2. ãƒ‘ãƒƒã‚¯ç·¨é›†/æ–°è¦ä½œæˆãƒ«ãƒ¼ãƒˆ
const packEditRoute = new Route({
	// è¦ªãƒ«ãƒ¼ãƒˆã‚’ packListRoute ã‹ã‚‰ dataRoute ã«å¤‰æ›´
	getParentRoute: () => dataRoute, 
	path: 'packs/$packId', // /data/packs/:packId
	component: () => <PackEditPage />, 
});


// 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼é ˜åŸŸ (/user)
const userRoute = new Route({
	getParentRoute: () => rootRoute,
	path: 'user',
});

interface OpenSearchParams { packId?: string; }
const cardPoolRoute = new Route({ 
	getParentRoute: () => userRoute, 
	path: 'pool', 
	// âœ… å®Ÿéš›ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‚ç…§
	component: CardPoolPage, 
});
const packOpenerRoute = new Route({
	getParentRoute: () => userRoute,
	path: 'open', 
	// âœ… å®Ÿéš›ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‚ç…§
	component: PackOpenerPage,
	validateSearch: (search: Record<string, unknown>): OpenSearchParams => ({ packId: search.packId as string | undefined }),
});

const deckListRoute = new Route({ 
    getParentRoute: () => userRoute, 
    path: 'decks', 
    component: DeckListPage, // ğŸ’¡ å®Ÿéš›ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ç½®ãæ›ãˆ
});
// ğŸ’¡ ä¿®æ­£: Propsæ¸¡ã—ã‚’å‰Šé™¤
const deckEditRoute = new Route({ 
    getParentRoute: () => deckListRoute, 
    path: '$deckId', 
    component: () => <DeckEditPage />, // ğŸ’¡ å®Ÿéš›ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ç½®ãæ›ãˆã€Propsæ¸¡ã—ã‚’å‰Šé™¤
});
const settingsRoute = new Route({ getParentRoute: () => rootRoute, path: 'settings', component: SettingsPage, });


// 5. ãƒ«ãƒ¼ãƒˆãƒ„ãƒªãƒ¼ã®çµåˆ
const routeTree = rootRoute.addChildren([
	indexRoute,
	// packEditRoute ã‚’ dataRoute ã®ç›´ä¸‹ã«è¿½åŠ 
	dataRoute.addChildren([packListRoute, packEditRoute]), 
	userRoute.addChildren([
		cardPoolRoute, 
		packOpenerRoute, 
		// deckEditRoute ãŒ deckListRoute ã®å­è¦ç´ ã¨ãªã‚‹ã‚ˆã†ã«ä¿®æ­£
		deckListRoute.addChildren([deckEditRoute])
	]),
	settingsRoute,
]);

export const router = createRouter({ routeTree, basepath: import.meta.env.BASE_URL,});

declare module '@tanstack/react-router' {
	interface Register {
		router: typeof router;
	}
}
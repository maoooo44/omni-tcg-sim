// src/features/pack-management/PackManager.tsx
import React from 'react';
import { usePackData } from './hooks/usePackData';
import type { Pack } from '../../models/pack';
import { Link } from '@tanstack/react-router'; // Linkã®ä½¿ç”¨ã¯PackPageã§ã¯ãªãã€ãƒªã‚¹ãƒˆã®é·ç§»ãƒœã‚¿ãƒ³ã§åˆ©ç”¨

interface PackManagerProps {
    initialPackId?: string;
}

const PackManager: React.FC<PackManagerProps> = ({ initialPackId }) => {
    // ğŸ’¡ è²¬å‹™ã‚’åˆ‡ã‚Šå‡ºã—ãŸHookã‹ã‚‰ã™ã¹ã¦ã®çŠ¶æ…‹ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’å–å¾—
    const { 
        packs, 
        currentPack, 
        setCurrentPack, 
        isLoading, 
        handleSave, 
        handleDelete, 
        handleNewPack 
    } = usePackData(initialPackId);

    if (isLoading) {
        return <div>ãƒ‘ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰ä¸­...</div>;
    }
    
    // --- ãƒ•ã‚©ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© ---
    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
        const { name, value } = e.target;
        if (currentPack) {
            setCurrentPack({ ...currentPack, [name]: value } as Pack);
        }
    };

    // --- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ---
    
    return (
        <div style={{ display: 'flex', gap: '30px', padding: '20px' }}>
            
            {/* 1. ãƒ‘ãƒƒã‚¯ä¸€è¦§ã‚¨ãƒªã‚¢ */}
            <div style={{ flex: '1', minWidth: '300px', borderRight: '1px solid #ccc', paddingRight: '30px' }}>
                <h2>ğŸ“¦ ãƒ‘ãƒƒã‚¯ä¸€è¦§ ({packs.length}ä»¶)</h2>
                <button onClick={handleNewPack} style={{ marginBottom: '15px' }}>
                    + æ–°è¦ãƒ‘ãƒƒã‚¯ã‚’ä½œæˆ
                </button>
                
                <ul style={{ listStyle: 'none', padding: 0 }}>
                    {packs.map(pack => (
                        <li key={pack.packId} style={{ border: pack.packId === currentPack?.packId ? '2px solid #007bff' : '1px solid #eee', padding: '10px', margin: '5px 0' }}>
                            <h4 style={{ margin: '0 0 5px 0' }}>{pack.name} ({pack.series})</h4>
                            <p style={{ margin: 0, fontSize: 'small' }}>
                                å°å…¥ {pack.cardsPerPack}æš | ç·åéŒ² {pack.totalCards}ç¨®
                            </p>
                            <div style={{ marginTop: '5px' }}>
                                {/* setCurrentPack ã§çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã€å³å´ã‚¨ãƒªã‚¢ã®ç·¨é›†å†…å®¹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ */}
                                <button onClick={() => setCurrentPack(pack)} style={{ marginRight: '10px' }}>ç·¨é›†</button>
                                <button onClick={() => handleDelete(pack.packId)} style={{ color: 'red' }}>å‰Šé™¤</button>
                                
                                {/* ğŸ’¡ é–‹å°ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å¼•ãæ¸¡ã—ï¼‰ */}
                                <Link 
                                  to="/user/open" 
                                  search={{ packId: pack.packId }}
                                  style={{ marginLeft: '10px', textDecoration: 'none' }}
                                >
                                  ğŸƒ é–‹å°
                                </Link>
                            </div>
                        </li>
                    ))}
                </ul>
            </div>
            
            {/* 2. ãƒ‘ãƒƒã‚¯ç·¨é›†ã‚¨ãƒªã‚¢ */}
            <div style={{ flex: '2' }}>
                <h2>{currentPack?.name ? `ãƒ‘ãƒƒã‚¯ç·¨é›†: ${currentPack.name}` : 'æ–°è¦ãƒ‘ãƒƒã‚¯ä½œæˆ'}</h2>

                {currentPack && (
                    <form onSubmit={(e) => { e.preventDefault(); handleSave(currentPack); }}>
                        <div style={{ marginBottom: '15px' }}>
                            <label style={{ display: 'block', marginBottom: '5px' }}>ãƒ‘ãƒƒã‚¯å:</label>
                            <input 
                                type="text" 
                                name="name" // nameå±æ€§ã‚’è¿½åŠ 
                                value={currentPack.name} 
                                onChange={handleInputChange}
                            />
                        </div>
                        {/* ... ä»–ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚åŒæ§˜ã« name å±æ€§ã¨ handleInputChange ã‚’ä½¿ç”¨ ... */}
                        
                        <p style={{ color: 'gray', fontSize: 'small' }}>
                            [âš ï¸ å°å…¥æšæ•°ã‚„ãƒ¬ã‚¢ãƒªãƒ†ã‚£è¨­å®šã®é«˜åº¦ãªãƒ•ã‚©ãƒ¼ãƒ UIã¯çœç•¥ã—ã¦ã„ã¾ã™]
                        </p>

                        <button type="submit" style={{ padding: '10px 20px', backgroundColor: '#007bff', color: 'white' }}>
                            ğŸ’¾ ãƒ‘ãƒƒã‚¯ã‚’ä¿å­˜
                        </button>
                    </form>
                )}
            </div>
        </div>
    );
};

export default PackManager;